<% layout("/layouts/boilerplate") %> 
<%= success %>

<!-- Navbar for Mobile Sidebar Toggle -->
<nav class="navbar navbar-light bg-light d-lg-none">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<!-- Mobile Sidebar (Offcanvas) -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Categories</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <a href="/listings" class="nav-link active">All</a>
    <a href="/listings/category/trending" class="nav-link"><i class="fa-solid fa-fire"></i> Trending</a>
    <a href="/listings/category/windmills" class="nav-link"><i class="fa-solid fa-wind"></i> Windmills</a>
    <a href="/listings/category/cabins" class="nav-link"><i class="fa-solid fa-house"></i> Cabins</a>
    <a href="/listings/category/mountain" class="nav-link"><i class="fa-solid fa-mountain-city"></i> Mountain City</a>
    <a href="/listings/category/warehouse" class="nav-link"><i class="fa-solid fa-warehouse"></i> Warehouse</a>
    <a href="/listings/category/castles" class="nav-link"><i class="fa-brands fa-fort-awesome"></i> Castles</a>
    <a href="/listings/category/beach" class="nav-link"><i class="fa-solid fa-umbrella-beach"></i> Beach</a>
    <a href="/listings/category/snowpoint" class="nav-link"><i class="fa-regular fa-snowflake"></i> Snowpoint</a>
    <a href="/listings/category/city" class="nav-link"><i class="fa-solid fa-city"></i> Top Cities</a>
  </div>

  <div class="tax-switch">
    <div class="form-check-reverse form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
      <label class="form-check-label" for="flexSwitchCheckDefault">Display with taxes</label>
    </div>
  </div>
</div>

<!-- Desktop Filter Links (Only Visible on Large Screens) -->
<div id="filter" class="d-none d-lg-flex flex-wrap justify-content-center gap-3 p-3">
  <a href="/listings" class="filter active"><i class="fa-solid fa-list"></i> All</a>
  <a href="/listings/category/trending" class="filter"><i class="fa-solid fa-fire"></i> Trending</a>
  <a href="/listings/category/windmills" class="filter"><i class="fa-solid fa-wind"></i> Windmills</a>
  <a href="/listings/category/cabins" class="filter"><i class="fa-solid fa-house"></i> Cabins</a>
  <a href="/listings/category/mountain" class="filter"><i class="fa-solid fa-mountain-city"></i> Mountain City</a>
  <a href="/listings/category/warehouse" class="filter"><i class="fa-solid fa-warehouse"></i> Warehouse</a>
  <a href="/listings/category/beach" class="filter"><i class="fa-solid fa-umbrella-beach"></i> Beach</a>
  <a href="/listings/category/snowpoint" class="filter"><i class="fa-regular fa-snowflake"></i> Snowpoint</a>
  <a href="/listings/category/city" class="filter"><i class="fa-solid fa-city"></i> Top Cities</a>
  
</div>

<!-- Listings -->
<div class="row row-cols-lg-3 row-cols-md-3 row-cols-sm-1 mt-3">
  <% for(let listing of allListings) { %>
    <a href="/listings/<%= listing._id %>" class="listing-link">
      <div class="card col listing-card">
        <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
        <div class="card-image-overlay">ABCD</div>
        <div class="card-body">
          <p class="card-text">
            <b><%= listing.title %></b> <br> <br>
            &#8377;<%= listing.price.toLocaleString("en-IN") %> /night
            <i class="tax-info"> &nbsp; +18% GST</i>
          </p>
        </div>
      </div>
    </a>
  <% } %>
</div>

<!-- JavaScript for Tax Toggle -->
<script>
  let taxSwitch = document.querySelector("#flexSwitchCheckDefault");
  taxSwitch.addEventListener("click", () => {
    let taxInfo = document.getElementsByClassName("tax-info");
    for (let info of taxInfo) {
      info.style.display = (info.style.display !== "inline") ? "inline" : "none";
    }
  });
</script>

<!-- CSS Styling -->
<style>
  /* Ensure Offcanvas Sidebar is Smooth */
  .offcanvas {
    width: 250px;
  }

  /* Desktop Navigation Links (Flexbox for Layout) */
  #filter a {
    text-decoration: none;
    color: #000;
    padding: 8px 15px;
    border-radius: 5px;
    transition: 0.3s;
  }

  #filter a:hover {
    background-color: #f0f0f0;
  }

  .filter.active {
    font-weight: bold;
    text-decoration: underline;
  }

  #mobileSidebar{
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
</style>

<!-- Bootstrap JS (Required for Sidebar) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
